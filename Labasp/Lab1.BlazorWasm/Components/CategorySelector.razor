@using Lab1.Domain.Entities
@inject IDataService DataService
@implements IDisposable

<div class="mb-3">
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="categoryDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            @if (DataService.SelectedCategory != null)
            {
                @DataService.SelectedCategory.Name
            }
            else
            {
                <text>Все категории</text>
            }
        </button>
        <ul class="dropdown-menu" aria-labelledby="categoryDropdown">
            <li>
                <button class="dropdown-item @(DataService.SelectedCategory == null ? "active" : "")" 
                        @onclick="() => SelectCategory(null)">
                    Все категории
                </button>
            </li>
            @foreach (var category in DataService.Categories)
            {
                <li>
                    <button class="dropdown-item @(DataService.SelectedCategory?.Id == category.Id ? "active" : "")" 
                            @onclick="() => SelectCategory(category)">
                        @category.Name
                    </button>
                </li>
            }
        </ul>
    </div>
</div>

@code {
    protected override void OnInitialized()
    {
        DataService.DataLoaded += StateHasChanged;
    }

    public void Dispose()
    {
        DataService.DataLoaded -= StateHasChanged;
    }

    private async Task SelectCategory(Category? category)
    {
        DataService.SelectedCategory = category;
        await DataService.GetSweetListAsync(1);
        StateHasChanged();
    }
}

